
@using License.MetCalWeb.Models
@using License.MetCalWeb.Helper;
@using License.Model
@{
    Layout = null;
}
@model TeamModel
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<style>
    tr {
        border: none !important;
    }

    .dropbtn {
        background-color: #FFFFFF;
        color: white;
        border: none;
        cursor: pointer;
    }

    .dropdown {
        position: relative;
        display: inline-block;
    }

    .dropdown-content {
        display: none;
        position: absolute;
        background-color: #f9f9f9;
        min-width: 160px;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        z-index: 1;
    }

        .dropdown-content a {
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
        }

            .dropdown-content a:hover {
                background-color: #f1f1f1;
            }

    .dropdown:hover .dropdown-content {
        display: block;
    }

    .dropdown:hover .dropbtn {
        background-color: #FFFFFF;
    }
</style>
<div class="row">
    @if (Model == null || (Model.AcceptedUsers.Count == 0 && Model.PendinigUsers.Count == 0))
    {
        <table class="table" style="border: none;">

            <tr>
                <td>
                    <div id="emptyTeamContainer" data-show-on-empty-team="true">
                        <h4>No other users are on your team</h4>
                        <h5>Invite others to start sharing data with your team</h5>
                        <button class="btn btn-primary btn-lg btn-custom" data-toggle="modal" data-target="#myModal">Invite Team Member</button>
                    </div>

                </td>
            </tr>
        </table>

    }
    else
    {

        <div class="form-group">
            @if (Model.PendinigUsers.Count > 0)
            {
                <h4>Pending Users</h4>
                <div class="col-md-12">
                    <table class="table" style="border: none">
                        @foreach (TeamMembers t in Model.PendinigUsers)
                    {
                            <tr>
                                <td class="col-md-8">
                                    @if (t.InviteeUser != null)
                        {
                                        <div>@t.InviteeUser.Name</div>
                                        <div>@t.InviteeUser.Email</div>
                                    }
                                    else
                                    {
                                        <div>@t.InviteeEmail</div>
                                    }
                                </td>
                                <td class="col-md-4">
                                    <div>@t.InvitationDate.Date.ToString("d")</div>
                                </td>
                            </tr>
                        }
                    </table>
                </div>
            }
        </div>
        <br />
        <div class="form-group">
            @if (Model.AcceptedUsers.Count > 0)
            {
                <h4>Active Users</h4>
                <div class="col-md-12">
                    <table class="table" style="border: none">
                        @foreach (TeamMembers t in Model.AcceptedUsers)
                        {
                            <tr>
                                <td class="col-md-6">
                                    @if (t.InviteeUser != null)
                                    {
                                        <div>@t.InviteeUser.Name</div>
                                        <div>@t.InviteeUser.Email</div>
                                    }
                                    else
                                    {
                                        <div>@t.InviteeEmail</div>
                                    }
                                </td>
                                <td class="col-md-2">
                                    @if (t.IsAdmin)
                                    {
                                        @Html.Image("/Images/admin.png", "Admin", "33", "33", null)
                                    }
                                    else
                                    {
                                        @Html.Image("/Images/Users-icon.png", "Admin", "33", "33", null)

                                    }
                                </td>
                                <td class="col-md-4">
                                    @if (Convert.ToBoolean(TempData["IsTeamAdmin"]))
                                    {

                                        <button class="alert-success">
                                            @Html.ActionLink("Add License", "MapLicense", "Team", new { userId = @t.InviteeUserId }, null)
                                            @*@Html.ActionLink("Add License", "LicenseCart", "Team", new { userId = @t.InviteeUserId }, null)*@

                                        </button>
                                        <button class="alert-success">@Html.ActionLink("Revoke License", "RevokeLicense", "Team", new { userId = @t.InviteeUserId }, null)</button>

                                    }
                                </td>
                                <td class="col-md-2">
                                    @if (LicenseSessionState.Instance.IsAdmin && @t.InviteeUserId != LicenseSessionState.Instance.User.UserId)
                                    {

                                        <div class="dropdown">
                                            <button class="dropbtn">
                                                <span>
                                                    @Html.Image("/Images/down-arrow.png", "Admin", "33", "33", null)
                                                </span>
                                            </button>
                                            <div class="dropdown-content">
                                                @if (!t.IsAdmin)
                                                {
                                                    @Html.ActionLink("Set As Admin", "UserConfiguration", "Team", new { id = @t.Id, userId = @t.InviteeUserId, actionType = "Admin" }, null)
                                                }
                                                else
                                                {
                                                    @Html.ActionLink("Remove Admin Access", "UserConfiguration", "Team", new { id = @t.Id, userId = @t.InviteeUserId, actionType = "RemoveAdmin" }, null)
                                                }
                                                @Html.ActionLink("Remove From Team", "UserConfiguration", "Team", new { id = @t.Id, userId = @t.InviteeUserId, actionType = "Remove" }, null)
                                            </div>
                                        </div>
                                    }
                                </td>
                            </tr>
                        }
                    </table>
                </div>
            }
        </div>
    }
    <div class="modal" id="myModal">
        @{ Html.RenderAction("Invite"); }
    </div>
</div>
