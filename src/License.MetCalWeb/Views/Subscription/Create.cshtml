@model IEnumerable<License.MetCalWeb.Models.Product>

@{
    ViewBag.Title = "CreateSubscription";
}
<link href="~/Content/ProductCatalogDetails.css" rel=" stylesheet" type="text/css" />


<h3>Create Subscription</h3>
<br />
<br />

@using (Html.BeginForm("Create", "Subscription", FormMethod.Post))
{
    <div class="row">
        <div class="col-md-12">
            <div class="form-group">
                <div class="col-md-4">Subscription Name</div>
                <div class="col-md-4"><input type="text" class="txt-sub" name="subscriptionName" /></div>
                <div class="col-md-4"></div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <div class="form-group">
                <div class="col-md-4">Product Name</div>
                <div class="col-md-4">Quantity</div>
                <div class="col-md-4">Price(USD)</div>
            </div>

        </div>
    </div>

    int index = -1;

    foreach (var product in Model)
    {
        index += 1;
        double price = @product.Price * @product.Quantity;

        <div class="row">
            <div class="col-md-12">
                <div class="form-group">
                    <div class="col-md-4 proName"><input type="checkbox" class="checkbox enableQty" name="selectedIndexAndProductIdList" value="index:@index pId:@product.Id" /> &nbsp; @product.Name</div>
                    <div class="col-md-4 proQty"><input type="text" class="txt-qty" name="qty" id="textQTYid+@product.Id" value="@product.Quantity" disabled="disabled" /></div>
                    <div class="col-md-4 proPrice"><input type="text" class="price_val" id="lblSelectedProductPrice" disabled="disabled" /></div>
                </div>
            </div>
        </div>
    }
    <div id="row2" class="col-md-12">
        Choose your maintainanse period
    </div>
    <div id="row3" class="col-md-12">
        <select name="activeDays">
            <option value="0">12 month included</option>
            <option value="1">24 month</option>
            <option value="2">36 month</option>
        </select>
    </div>
    <div id="row4" class="col-md-12" align="right">
        <input type="submit" name="status" value="Create Subscription" class="btn btn-default btn-custom btn-save" />
    </div>
    <div id="row5" class="col-md-12" align="right">
        SubTotal(USD)<br />
        <input type="text" class="total" id="lblSelectedProductPrice" disabled="disabled" />
    </div>
    <div class="row">
        <div class="col-md-12">
            <label id="lblError" style="display:none;">
                No products are selected
            </label>
        </div>
    </div>
}

<script>
    $(document).ready(function () {

        var total = 0;
        $('.btn-save').click(function () {
            var isPostEnabled = true;
            i = 0;
            $('input[type=checkbox]:checked').each(function () {
                i++;
            });
            if (i == 0) {
                $('#lblError').attr('style', 'display:inline;color:red;');
                isPostEnabled = isPostEnabled && false;
            }
            else {
                $('#lblError').attr('style', 'display:none;');
                isPostEnabled = isPostEnabled && true;
            }
            return isPostEnabled;
        });

        $('.enableQty').on('click', function () {
            var data = $(this).is(':checked');
            var qtyObj = $(this).parent().parent();
            var txtQty = $(qtyObj).find('.proQty').find('.txt-qty');
            var price = $(qtyObj).find('.proPrice').find('#lblSelectedProductPrice');
            var amount = $('.total').val();
            var selectedProdQTY = $(price).val();
            if (data == true) {
                $(txtQty).removeAttr('disabled');
            }
            else {
                $(txtQty).attr('disabled', 'disabled');
                $(selectedProdQTY).val('');
                $(txtQty).val('');
                if (amount == "")
                    amount = 0;
                amount = parseInt(amount) - parseInt(selectedProdQTY);
                $('.total').val(amount);
            }
        });


        $('.txt-qty').on('change', function () {
            var price = 5;
            var parentObj = $(this).parent().parent();
            var qty = $(this).val();
            var selectedProdQTY = qty * price;
            console.log($(parentObj));
            var lblObj = $(parentObj).find('.proPrice').find('#lblSelectedProductPrice');
            console.log(lblObj);
            $(parentObj).find('.proPrice').find('#lblSelectedProductPrice').val(selectedProdQTY);

            var amount = $('.total').val();
            if (amount == "")
                amount = 0;
            amount = parseInt(amount) + selectedProdQTY;
            $('.total').val(amount);
        });

    });



</script>



